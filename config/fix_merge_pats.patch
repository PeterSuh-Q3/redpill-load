*** a/config/merge_pats.sh
--- b/config/merge_pats.sh
@@
-  python3 - <<'PY' > "$PAIRS_TSV"
- import re, sys
- fn = sys.argv[1] if len(sys.argv) > 1 else None
- if not fn:
-     fn = "$RESULT_FILE"  # 이 라인은 쉘에서 치환되므로 안전함
- url_re = re.compile(r'"url"\s*:\s*"([^"]+)"', re.IGNORECASE)
- sum_re = re.compile(r'"sum"\s*:\s*"([0-9a-fA-F]{32})"', re.IGNORECASE)
- urls=[]
- sums=[]
- with open(fn, 'r', encoding='utf-8') as f:
-     for line in f:
-         u = url_re.search(line)
-         if u:
-             urls.append(u.group(1))
-             continue
-         s = sum_re.search(line)
-         if s:
-             sums.append(s.group(1).lower())
- # 두 리스트를 순서대로 매칭(파일 구조에 따라 url 다음에 sum이 오는 형식 가정)
- i = 0
- j = 0
- out = []
- while i < len(urls) and j < len(sums):
-     out.append(f"{urls[i]}\t{sums[j]}")
-     i += 1
-     j += 1
- # 출력
- for l in out:
-     sys.stdout.write(l + "\n")
- PY
+  # Pass RESULT_FILE as argv to avoid here-doc variable expansion issues
+  python3 - "$RESULT_FILE" <<'PY' > "$PAIRS_TSV"
+import re, sys
+# argv[0] is '-', argv[1] is RESULT_FILE passed from the shell
+if len(sys.argv) < 2:
+    raise SystemExit("ERROR: missing result file argument")
+fn = sys.argv[1]
+url_re = re.compile(r'"url"\s*:\s*"([^"]+)"', re.IGNORECASE)
+sum_re = re.compile(r'"sum"\s*:\s*"([0-9a-fA-F]{32})"', re.IGNORECASE)
+urls=[]
+sums=[]
+with open(fn, 'r', encoding='utf-8') as f:
+    for line in f:
+        u = url_re.search(line)
+        if u:
+            urls.append(u.group(1))
+            continue
+        s = sum_re.search(line)
+        if s:
+            sums.append(s.group(1).lower())
+# 두 리스트를 순서대로 매칭(파일 구조에 따라 url 다음에 sum이 오는 형식 가정)
+i = 0
+j = 0
+out = []
+while i < len(urls) and j < len(sums):
+    out.append(f"{urls[i]}\t{sums[j]}")
+    i += 1
+    j += 1
+# 출력
+for l in out:
+    sys.stdout.write(l + "\n")
+PY
